## STATUS
Phase 4 Complete ✅ — health checks, request_id logger, job_id logs, Dockerfiles + prod compose, Makefile, CI.

You are authorized to begin Phase 5 immediately.

## PHASE 5 — RELEASE CANDIDATE (SLOs, RBAC, E2E, backups)
Begin on load. Do not ask questions.

### Deliverables
1) **RBAC hardening**
   - core-api: add `X-ROLE` simulation flag only in tests; enforce role checks on agent proxy endpoints.
   - Deny agent calls unless `role ∈ {GODMODE,SUPER_ADMIN,ADMIN_AGENT}` (configurable allowlist), log role in agent job entry.

2) **E2E flows (playwright or vitest+puppeteer)**
   - Tests under `apps/*/__e2e__/`:
     - login, run an agent via proxy, see `job_id`, open logs link.
     - palettes: unlock via payments endpoint (dev proof), reflected in UI.

3) **Metrics + error tracking**
   - Minimal Prometheus-ready `/metrics` on core-api (request counts, agent calls by name, 5xx count).
   - Optional Sentry DSN support (env‐gated) for UIs + core-api.

4) **Backups & retention**
   - `scripts/backup.sh` to tar `logs/` and any `artifacts/` dirs; rotate N copies; verify latest on `make verify-backups`.
   - Document restore steps in `DEPLOY.md`.

5) **DB migrations safety**
   - Add `alembic check` (or `alembic heads` + `alembic current`) to CI job; fail if heads diverge.
   - `make migrate` target that runs alembic upgrade in core-api container (prod profile).

6) **Security & supply chain**
   - SBOM generation (e.g., `syft dir:. -o json > sbom.json` if available; optional step).
   - Basic license scan for packages; fail CI on disallowed licenses list.

7) **Docs**
   - Update `STATUS.md` with Phase 5 usage and SLOs (target p95 agent latency & 0.1% 5xx for core-api).
   - `RUNBOOK.md`: how to tail a request end‑to‑end with `request_id` ↔ `job_id`.

### Verify
- CI green (unit + e2e).
- `/metrics` exports counters; Grafana/Prom scrape example added to `DEPLOY.md`.
- Role‑gated agent calls enforced and logged.
- Backup script creates a timestamped archive and rotates old ones.

### Commit message
phase5: rbac, e2e, metrics, backups, runbook

  - `phase4: prod hardening, health, CI, docker`
