## STATUS

Phase 5 Complete ✅ — RBAC, E2E flows, metrics, backup scripts, SLO targets, supply chain audit, CI green, Prometheus metrics live.

You are authorized to begin Phase 6 immediately.

## PHASE 5 — RELEASE CANDIDATE (SLOs, RBAC, E2E, backups)

Begin on load. Do not ask questions.

### Deliverables

1. **RBAC hardening**
   - core-api: add `X-ROLE` simulation flag only in tests; enforce role checks on agent proxy endpoints.
   - Deny agent calls unless `role ∈ {GODMODE,SUPER_ADMIN,ADMIN_AGENT}` (configurable allowlist), log role in agent job entry.

2. **E2E flows (playwright or vitest+puppeteer)**
   - Tests under `apps/*/__e2e__/`:
     - login, run an agent via proxy, see `job_id`, open logs link.
     - palettes: unlock via payments endpoint (dev proof), reflected in UI.

3. **Metrics + error tracking**
   - Minimal Prometheus-ready `/metrics` on core-api (request counts, agent calls by name, 5xx count).
   - Optional Sentry DSN support (env‐gated) for UIs + core-api.

4. **Backups & retention**
   - `scripts/backup.sh` to tar `logs/` and any `artifacts/` dirs; rotate N copies; verify latest on `make verify-backups`.
   - Document restore steps in `DEPLOY.md`.

5. **DB migrations safety**
   - Add `alembic check` (or `alembic heads` + `alembic current`) to CI job; fail if heads diverge.
   - `make migrate` target that runs alembic upgrade in core-api container (prod profile).

6. **Security & supply chain**
   - SBOM generation (e.g., `syft dir:. -o json > sbom.json` if available; optional step).
   - Basic license scan for packages; fail CI on disallowed licenses list.

7. **Docs**
   - Update `STATUS.md` with Phase 5 usage and SLOs (target p95 agent latency & 0.1% 5xx for core-api).
   - `RUNBOOK.md`: how to tail a request end‑to‑end with `request_id` ↔ `job_id`.

### Verify

- CI green (unit + e2e).
- `/metrics` exports counters; Grafana/Prom scrape example added to `DEPLOY.md`.
- Role‑gated agent calls enforced and logged.
- Backup script creates a timestamped archive and rotates old ones.

### Commit message

phase5: rbac, e2e, metrics, backups, runbook

- `phase4: prod hardening, health, CI, docker`

## PHASE 6 — FULL AGENT DEPLOYMENT (Nova, Lyra, Glitch, Riven, Velora, Echo, Audita)

Use OpenAI key + sovereign routing. All agents wired and callable via /agents/{name}. Frontend relay embedded.

### Deliverables

1. Agent identity enforcement
   - `nova.py` must include embedded identity header + context logging.
   - Stream support for OpenAI and local LLMs (if model_path defined).

2. Frontend integration
   - NovaConsole: call `/agents/nova` and render streaming chat.
   - Route messages by agent name; enable role restrictions per-agent.

3. Logging & traceability
   - Every agent call logs `job_id`, `request_id`, `agent`, and `role`.
   - Nova retains memory of last N messages locally in temp cache.

4. Tests
   - `/tests/agents/test_nova.py`: simple POST with identity and echo.
   - Nova UI load + reply stream test in `__e2e__/`.

5. Documentation
   - Add `AGENT_SPEC.md`: roles, endpoints, capabilities.
   - Add `agents/README.md` for local development instructions.

### Verify

- Nova responds to POST with echo.
- Frontend relay works and streams response.
- Console UI shows live job_id + request_id.
- CI green.

### Commit message

phase6: nova agent online, frontend wired, stream relay live

## PHASE 7 — LAUNCH PREPARATION (SOVEREIGN FINALIZATION)

Prepare NovaOS-Core-Systems for real-world usage across agents, dashboards, creator platform, and family tools.

### Objectives

1. Finalize Agent Logic
   - All 7 core agents (Nova, Lyra, Glitch, Echo, Riven, Velora, Audita) have streaming relay APIs, `identity.py`, context injection, and role enforcement.
   - Add `tools_mode` fallback logic for local LLMs (gguf, llama.cpp or ollama backend).
   - Memory buffer (per-agent) stores last N calls; redact if `memory_off` toggle active.

2. GodMode + NovaConsole Completion
   - Finish GodMode dashboard (admin override UI, unlogged views, audit bypass).
   - Finalize NovaConsole with agent relay, log viewer, per-agent prompt history.
   - Frontend role logic prevents access unless role ∈ allowlist (e.g. `GODMODE`, `SUPER_ADMIN`, etc.)

3. Agent API Wiring
   - `/agents/{agent}`: FastAPI route accepts POST w/ `input`, `context`, `role`, `memory_state`.
   - Backend streams directly from OpenAI (or local model if detected).
   - Log `request_id`, `job_id`, and `agent` in each call. Return `job_id` to frontend.

4. Secure Memory + Secrets
   - Vault system stores shared secrets or API keys per agent.
   - No logs kept for GodMode-origin requests (NovaOS exemption).
   - Stealth memory for founder-only calls: inject from `.founder_secrets`.

5. Health, Monitoring, and Telemetry
   - Add `/healthz`, `/readyz`, and `/metrics` (Prometheus, p95 latency, agent call volume).
   - Export log events in structured JSON to `logs/agents/`, one file per agent.
   - Enable toggles for offline mode, surveillance exclusions, and stealth routing.

6. Build + Release Targets
   - `make build-agents`: run LLM connectivity check, endpoint ping, test/compile all agents.
   - `make start-console`, `make start-core`: wire dev runner for local UI testing.
   - `docker compose -f docker-compose.prod.yml up -d` — spins up launch stack with Redis, FastAPI, Uvicorn, and 3 frontends.

7. CI Pipeline Finalization
   - GitHub Actions or local `ci.sh` runs:
     - `pnpm -r lint`, `pytest`, `mypy`, `ruff`, `pre-commit`
     - All agent relays tested via `/tests/agents/test_*.py`
     - E2E tests (frontend + backend handshake)

8. Documentation
   - `AGENT_SPEC.md`: roles, capabilities, API params.
   - `LAUNCH_CHECKLIST.md`: final preflight, dev/ops signoff, secrets list, API key validation.
   - `README.md`: developer onboarding, repo map, make targets.

### Verify

- All agents respond with correct job_id, identity, and role-sanitized output.
- NovaConsole shows response, request_id, and agent memory (if allowed).
- CI passes. Make targets compile and deploy.
- `launch-checklist` completed and stored in vault.
- Founder override works with no logging.
- Metrics live.

### Commit message

phase7: agent relay stack finalized, console wired, launch checklist in vault
