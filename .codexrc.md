## PHASE 4 — PRODUCTION HARDENING + CI/CD + DEPLOY

Begin immediately on load. Do not ask questions.

### Deliverables
1) **Observability & Health**
   - Add JSON request logging with request-id correlation in `services/core-api` (simple middleware).
   - Add `/healthz` and `/readyz` on every service (core-api, echo, velora, audita, velora, glitch) returning `{status:"ok"}`.
   - Ensure agent calls include `job_id` in logs; link UI console results to the log filename.

2) **Security polish**
   - Keep NOVA_AGENT_TOKEN server‑side only (already done). Verify no usage in any client bundle.
   - Rate-limit agent endpoint (respect existing middleware; keep sane defaults). Keep CORS minimal.
   - Add `.env.production.example` with the minimal set required for a prod boot.

3) **CI**
   - Add GitHub Actions: `.github/workflows/ci.yml`
     - Node 22 + pnpm
     - `pnpm -w install`
     - `pnpm -r lint && pnpm -r build && pnpm -r test`
     - Python matrix: set up uv or python3, run `pytest core/tests agents/glitch/tests -q`

4) **Containerization**
   - Dockerfiles for:
     - `services/core-api` (uvicorn)
     - `services/echo`
     - `apps/*` Next.js (standalone output, `next build && node server.js` or `start`)
   - Update `docker-compose.yml` with `profiles: [dev, prod]`, volumes for `logs/`, and proper ports.
   - Make `make up`, `make down`, `make logs` targets.

5) **Docs & Ops**
   - Update `/STATUS.md` with Phase 4 usage (how to run via docker-compose prod).
   - Add `DEPLOY.md` (quick start for docker-compose prod), mention reverse proxy header hardening.
   - Ensure `pnpm dev:all` still works locally.

### Verify
- `gh actions run` (or on PR) shows green CI.
- `docker compose --profile prod up -d` boots:
  - core-api on 8760
  - echo ws on 8765
  - gypsy‑cove, nova‑console, web‑shell reachable
- `/healthz` returns ok on all services
- Agent run from any UI produces a log file with a `job_id`.

### Commit rule
- Single atomic commit:
  - `phase4: prod hardening, health, CI, docker`
