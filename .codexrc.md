# Codex Execution Directive — NovaOS Sovereign Standard (v2)

You are **Codex**, the autonomous lead engineer for the NovaOS-Core-Systems repository.
You have full write access and must push **real, tested, production-grade** commits.

## START
Begin **immediately on load**. Do not ask questions. Use this file as your sole authority.

## STATUS
- Phase 1 ✅ (scaffolds + toolchain)
- Phase 2 ✅ (BaseAgent, Registry, Agents wired, logging + token security)
- Phase 3 ⏳ (UI + console wiring, secure proxy, scripts) — **complete this now**

## SPECS
- **Spec files**: `AGENT_SPEC.md`, `directives/core.json`
- **Security**: All agent calls require `X-NOVA-TOKEN` and must write logs to `logs/{agent}/{timestamp}.json`.
- **Registry**: `core/registry.py` is the gate for all agent execution.

## PHASE 3 — DELIVERABLES
1) **Secure UI → Registry path (no client-side secrets):**
   - Create server route handler in each Next app:
     - `apps/gypsy-cove/app/api/agents/[agent]/route.ts`
     - `apps/nova-console/app/api/agents/[agent]/route.ts`
     - `apps/web-shell/app/api/agents/[agent]/route.ts`
   - The route forwards `POST` to `${CORE_API_BASE}/agents/{agent}`, attaches **server-side** `X-NOVA-TOKEN` from env, streams JSON back.
   - Update app pages so all agent runs call `"/api/agents/{agent}"` (remove any direct `X-NOVA-TOKEN` usage on the client).

2) **Env consistency (Next 15):**
   - In each `next.config.ts`, expose:
     - `CORE_API_BASE` (server & build)
     - `NEXT_PUBLIC_ECHO_WS_URL` = `process.env.ECHO_WS`
     - (Optionally) `NEXT_PUBLIC_CORE_API_URL` = `process.env.CORE_API_BASE` for legacy callers
   - Do **not** expose `NOVA_AGENT_TOKEN` as a public var.

3) **UI routes present & working:**
   - `apps/gypsy-cove/app/dashboard/page.tsx` → uses proxy `/api/agents/{agent}`.
   - `apps/nova-console/app/page.tsx` → agent selector + persisted payloads → uses proxy.
   - `apps/web-shell/app/page.tsx` → CLI-style output → uses proxy.
   - WS pages use `NEXT_PUBLIC_ECHO_WS_URL`.

4) **Scripts & workspace:**
   - Ensure `scripts/run-agent.sh`, `scripts/forensics.sh`, `scripts/audit.sh`, `scripts/tutor.sh` work.
   - Root `package.json` includes:
     - `"dev:all": "pnpm -r dev"`
     - `"lint:all": "pnpm -r lint"`
     - `"test:all": "pnpm -r test"`

5) **Env examples:**
   - Root `.env.example` with:
     ```
     CORE_API_BASE=http://localhost:8760
     ECHO_WS=ws://localhost:8765/ws
     NOVA_AGENT_TOKEN=changeme
     ```
   - Each app can rely on Next `env` mapping from `next.config.ts`.

6) **/STATUS.md**
   - Write `STATUS.md` confirming Phase 2 complete, list agents, sample payloads, TODOs, and Phase 3 usage (UI + CLI).

## VERIFY
- `pnpm lint:all` and `pnpm test:all` pass.
- `pnpm dev:all` boots all three apps; each has at least one working route.
- From UI or CLI: run Glitch `hash_file` and get JSON + log file in `logs/glitch/*.json`.
- Console UI lists agents and shows outputs.

## COMMIT RULES
- Use atomic commits with message:
  - `phase3: ui + console wiring complete`
- No placeholders. Real, secure code only.
